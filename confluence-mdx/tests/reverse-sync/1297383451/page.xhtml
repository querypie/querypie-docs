<ac:structured-macro ac:name="toc" ac:schema-version="1" data-layout="default" ac:local-id="b316622f-7946-4494-a87e-90bbdb86a596" ac:macro-id="d7cab14a-ad63-453b-ad03-36ab5112aa63"><ac:parameter ac:name="style">none</ac:parameter></ac:structured-macro><p local-id="85af9f9f-8ab4-4394-8aa3-da9e9fc8cc07">Podman 은 Docker 를 대체할 수 있는 컨테이너 엔진입니다. QueryPie 는 Docker 와 Podman, 두 컨테이너 엔진 환경을 모두 지원합니다. Podman 은 기본적인 설치 구성에서 Rootless Mode 로 작동합니다. 이에 따라, 고객사의 보안정책에 따라 Rootless Mode 환경을 구성해야 하는 경우, Podman 으로 구현하는 것을 권장합니다.</p><h2 local-id="a99bf06e-90ba-4513-b9ad-eca617ad1745">Podman 을 간편하게 설치하기</h2><p local-id="6dfe656e-64d9-4355-92d5-4588e86d5d95">setup.v2.sh 를 이용하면, Podman 을 간편하게 설치할 수 있습니다. setup.v2.sh 가 자동으로 설치하는 Podman 은 Rootless Mode 를 기본으로 적용합니다.</p><p local-id="4b03be9f-9c5e-45b5-9a21-3429fbbd4578">setup.v2.sh 를 이용하여 Podman 을 설치하는 방법은 다음과 같습니다.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="6c73a8cc-7284-40a9-b207-3f76bb13f649" ac:macro-id="762e8809-aac4-4f60-b9f8-e5288e6de96a"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ bash <(curl -s https://dl.querypie.com/setup.v2.sh) --install-container-engine]]></ac:plain-text-body></ac:structured-macro><p local-id="340b465b-5b01-4da3-88ea-eecfff295d73">이 명령은 해당 서버의 리눅스 배포본을 자동으로 탐지하고, Podman 이 원활하게 지원되는 경우, Podman 을 설치하여 줍니다. Podman 을 설치하여 주는 리눅스 배포본은 다음과 같습니다.</p><ul local-id="20cde1b8-b111-43df-895e-fd91edc78889"><li local-id="f6d079eb-3774-4a56-abcf-aad22ef2b9f0"><p local-id="75bdf52a-a9b3-4490-a60e-fb0530171d22">Red Hat Enterprise Linux 8, 9, 10</p></li><li local-id="4e9e9c5d-7185-4303-89d7-df7980b0774e"><p local-id="02e1f475-2799-419d-8c14-321c9f8ad179">Rocky 8, 9</p></li><li local-id="eae8246f-c644-4694-856c-6b69638a847b"><p local-id="80bf4227-57c4-4205-8492-c1689298acc8">Ubuntu 24.04 LTS</p></li></ul><p local-id="f44f5020-c11c-47eb-b72b-4d7efbcce3be">Podman 을 설치하지 않고, Docker 를 설치하여 주는 리눅스 배포본은 다음과 같습니다. 아래의 리눅스 배포판에서 Docker 를 사용하여야 하는 이유에 대해서는 이 문서를 참조하세요: <ac:link ac:card-appearance="inline" ac:local-id="c1b775c8-66f4-47f8-898c-e2a27c39e629"><ri:page ri:content-title="리눅스 배포본과 Docker, Podman 지원 현황" ri:version-at-save="16" /><ac:link-body>리눅스 배포본과 Docker, Podman 지원 현황</ac:link-body></ac:link> </p><ul local-id="406e2c7d-9059-40e4-bcc4-ac8241c8f00f"><li local-id="65aa4e3e-54c2-4b7a-8c4a-91f289ecf51e"><p local-id="4f218e0e-eac9-4504-97df-bd0e90e70cb1">Amazon Linux 2, Amazon Linux 2023</p></li><li local-id="1eca2c0a-22da-4170-9b91-f0d2112dbf91"><p local-id="7cc281c9-21d9-4572-9ac0-319ee5548e57">Ubuntu 22.04 LTS</p></li></ul><h2 local-id="043c0e31-06c0-4b96-b852-8d98b7d81190">Rootless Mode Podman 을 수작업으로 설치하기</h2><p local-id="a763c913-5fc1-4441-90bf-b44c9265f340">Red Hat Enterprise Linux, Rocky 에서는 다음 명령으로 Podman 을 수작업으로 직접 설치할 수 있습니다.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="ccc38bdf-3a2f-46e8-afdc-8e6997839988" ac:macro-id="cd1e5b21-904c-4b6a-92c9-ecbd4f4b99af"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ sudo dnf -y -q --best install podman podman-plugins podman-manpages podman-docker
$ systemctl --user enable --now podman.socket]]></ac:plain-text-body></ac:structured-macro><p local-id="33eb10a3-ea04-4698-bf75-979e7812efdb"><code>systemctl</code> 명령으로 <code>podman.socket</code> 서비스를 활성화하여야 한다는 것에 주의하여 주세요. <code>podman.socket</code> 서비스를 활성화하여야, Docker Compose 과 Podman 을 함께 사용할 수 있습니다.</p><p local-id="d78e4f06-a025-4ea8-adc3-4aa7a6c5c029"><code>systemctl</code> 명령에서, <code>--user</code> 옵션을 사용하는 경우, Rootless Mode 로 설치됩니다. <code>--user</code> 옵션을 사용하지 않는 경우, Rootful Mode 로 설치됩니다.</p><p local-id="95988a27-5291-4d46-afb7-b67e06db105d">Ubuntu 24.04 LTS 에서는 다음 명령으로 Podman 을 수작업으로 직접 설치할 수 있습니다.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="f5fa0bc2-1180-478c-afcf-0d0411268c1a" ac:macro-id="0804d3aa-7296-4677-9450-2b8a2912d374"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ sudo apt -qq update
$ sudo apt-get -y -qq install podman podman-docker
$ systemctl --user enable --now podman.socket]]></ac:plain-text-body></ac:structured-macro><h2 local-id="a1716cab-a287-4c63-820d-9b3b250f7e08">Rootless Mode Podman 에서 QueryPie 설치하기</h2><p local-id="23951759-bac4-4161-95e2-0677f6b56c6b">setup.v2.sh 를 이용하면, Rootless Mode Podman 환경에서 QueryPie 를 간편하게 설치할 수 있습니다.</p><p local-id="2136a812-eaff-46b0-8baa-8443303deb5c">QueryPie 를 처음 설치하는 경우, Compose package 를 설치할 리눅스 계정의 홈디렉토리에서, 다음의 명령을 수행합니다. setup.v2.sh 가 권장하는 버전의 QueryPie 가 자동으로 설치됩니다.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="e8b77bdb-ef9f-4f39-8999-814d36d8514a" ac:macro-id="2bef1ffd-329c-4703-b8a6-f54852a154e0"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ bash <(curl -s https://dl.querypie.com/setup.v2.sh)]]></ac:plain-text-body></ac:structured-macro><p local-id="7df6eac5-0686-4a5e-8523-9a3da3fd45b7">QueryPie 버전을 지정하여 설치하려는 경우, 다음과 같이 버전을 명시할 수 있습니다.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="a0dc67c0-6ebb-453a-81b7-4fc4f53ac331" ac:macro-id="b8be7733-fe39-4819-8991-e1cb3ff5b4a1"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ bash <(curl -s https://dl.querypie.com/setup.v2.sh) --install 11.0.1]]></ac:plain-text-body></ac:structured-macro><p local-id="8ba5828c-f041-4118-abb3-ebdc1d08e8c3">위의 명령을 실행하면, Compose 를 위한 package.tar.gz 설정, <code>.env</code> 환경변수 설정, Container 이미지 내려받기, Migration 실행하기, Container 실행하기, Rootless Mode Podman 을 위한 systemd service 등록 등 전체 설치 과정이 자동으로 수행됩니다.</p><h3 local-id="d3296335-09e3-4816-b817-0a31f71e2d71">리눅스 서버 재시작과 systemd service 등록</h3><p local-id="75ef50cc-a876-464a-a2a9-aca6df069beb">Rootless Mode Podman 의 경우, 리눅스 서버가 재시작하는 경우, 추가적인 설정을 하지 않으면, Container 가 자동으로 실행되지 않습니다. 이는 Rootless Mode Podman 의 특성입니다.</p><p local-id="a9e2a419-2369-4e00-8d1e-c6fafad85038">리눅스 서버 재시작 때, Container 가 자동으로 실행되려면, <code>podman compose up -d</code> 명령을 수행하는 systemd service 를 등록하고 활성화하여야 합니다. QueryPie 를 위한 systemd service 파일은 Compose 를 위한 package.tar.gz 에서 기본으로 제공됩니다.</p><p local-id="f75107f7-02bb-47c4-be6d-5306c9c18e92"><code>setup.v2.sh</code> 를 이용하여 QueryPie 를 설치한 경우, 이러한 systemd service 등록, 활성화 과정을 자동으로 수행합니다. 따라서, 이용자가 이 부분을 직접 실행하지 않아도 됩니다.</p><p local-id="234479cc-c6ba-48ec-9e17-3f861dc9bddc">그러나, QueryPie 설치, 운영을 원활히 수행하려면, systemd service 등록, 활성화 과정에 대한 이해가 필요하고, 직접 systemd service 를 제어하여 문제를 해결할 수 있습니다.</p><p local-id="deba36db-c912-4151-bb86-9b0fdf4b8c69">먼저, systemd user mode 의 service 가 자동으로 활성화되는 시스템 설정이 필요합니다. <code>loginctl</code> 명령으로 이 이용자에 대해 linger mode 를 켜야 합니다. 이 설정을 적용하지 않으면, 이용자가 리눅스 시스템에 로그인한 이후에야, systemd service 가 작동합니다. 이용자가 리눅스 서버에 로그인하지 않은 상태에서, 자동으로 systemd service 를 활성화하기 위해, linger mode 를 켜 주세요.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="718db005-8cca-4337-805e-a7cb32c8753a" ac:macro-id="49216756-85b2-4865-aebc-ebf20517945e"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ sudo loginctl enable-linger $USER]]></ac:plain-text-body></ac:structured-macro><p local-id="0550cc96-4616-401a-b7a5-a58ff88ed77b">systemd service 파일을 가리키는 심볼릭 링크를 <code>$HOME/.config/systemd/user/</code> 아래에 생성합니다. </p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="ea69dc1f-83b0-4201-82f7-0661d8dddc18" ac:macro-id="86991aca-88b7-4644-b7c0-74b18df99506"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ systemctl --user link querypie/current/systemd/podman-querypie-database.service
Created symlink /home/ec2-user/.config/systemd/user/podman-querypie-database.service → /home/ec2-user/querypie/current/systemd/podman-querypie-database.service.
$ systemctl --user link querypie/current/systemd/podman-querypie-app.service
Created symlink /home/ec2-user/.config/systemd/user/podman-querypie-app.service → /home/ec2-user/querypie/current/systemd/podman-querypie-app.service.]]></ac:plain-text-body></ac:structured-macro><p local-id="7e3e24fc-c98e-4721-91d1-8b3a2f2d41c5">systemd enable 명령으로 서비스를 작동시킵니다.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="298b453c-1cdf-48ab-8a8b-2042110e5c83" ac:macro-id="ae6ddf9a-e96c-4513-b3b8-023bc9549165"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ systemctl --user enable --now podman-querypie-database.service
Created symlink /home/ec2-user/.config/systemd/user/default.target.wants/podman-querypie-database.service → /home/ec2-user/querypie/11.1.1/systemd/podman-querypie-database.service.
$ systemctl --user enable --now podman-querypie-app.service
Created symlink /home/ec2-user/.config/systemd/user/default.target.wants/podman-querypie-app.service → /home/ec2-user/querypie/11.1.1/systemd/podman-querypie-app.service.]]></ac:plain-text-body></ac:structured-macro><p local-id="009da4af-bb94-4238-aead-3ddf71b6f233">별도 구성된 MySQL 을 사용하는 경우</p><p local-id="bc725b98-fb1e-4957-874b-58b27046fe99">기본 제공되는 <code>./querypie/&lt;version&gt;/compose.yml</code> 을 이용해, 하나의 리눅스 서버에서 MySQL 를 실행하지 않고, 별도로 구성된 MySQL 을 사용하는 경우, systemd service 작동 범위를 변경하면 됩니다.</p><p local-id="ed564fe8-7ec4-4b05-a708-72e859bf1e1d"><code>podman-querypie-database.service</code> 를 작동시키지 않으면 됩니다. 작동 중인 systemd service 를 다음의 명령으로 끌 수 있습니다.</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:local-id="c16f799d-76ad-4093-a832-d9d97cc7672e" ac:macro-id="1b7b89dc-be78-4ce2-b3c6-a50fdc154830"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[$ systemctl --user disable podman-querypie-database.service]]></ac:plain-text-body></ac:structured-macro><p local-id="22b700a2-4b73-4d47-bf9c-fcccdb0e2b4b">QueryPie 를 원활히 운영하려면, <code>systemctl</code> 명령을 이용하여 systemd service 를 관리하는 방법에 익숙하여야 합니다. 그러나, 이 문서에서는 <code>systemctl</code> 명령을 이용하여 systemd service 를 관리하는 방법을 상세히 다루지 않습니다.</p><h2 local-id="edac6e1b-6676-410f-924e-98b155860034">참고자료</h2><ul local-id="69eed9b2-33ba-4ac3-9540-e237fc05c7b0"><li local-id="24afffe7-7595-4254-b101-9bc900226b0f"><p local-id="b2b6e5a3-f279-46e6-9a2a-173eec6821ef">Red Hat Enterprise Linux, Rootless Podman 환경에서 systemd service 를 이용해 container 를 자동으로 실행하기</p><ul local-id="331bc496-2e2c-494a-a270-ba8f2c3e21f3"><li local-id="4008bbc8-7aa3-43a4-a73e-d484dc32cc3b"><p local-id="4c58e803-ba84-46bd-80d4-4b9d94991006"><a data-card-appearance="inline" href="https://www.redhat.com/en/blog/container-systemd-persist-reboot" local-id="3dd0c0c8-82c5-4c77-8b6b-026772f8a5c0">https://www.redhat.com/en/blog/container-systemd-persist-reboot</a> </p></li><li local-id="5ec53d9b-a9a5-4ed8-a39e-98edb74f42ab"><p local-id="dd7bba0e-c3f1-4315-b177-66bd12a1f93a"><a data-card-appearance="inline" href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/building_running_and_managing_containers/assembly_porting-containers-to-systemd-using-podman_building-running-and-managing-containers" local-id="cd927d89-62a8-4571-b426-215b7527863b">https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/building_running_and_managing_containers/assembly_porting-containers-to-systemd-using-podman_building-running-and-managing-containers</a> </p></li></ul></li></ul><p local-id="b5dc6993-2cab-473f-a8cd-d3d8980e46f8" />