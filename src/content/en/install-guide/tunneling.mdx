# üîó Connect with Local Databases

This guide explains how to connect databases running locally to the QueryPie AI service. It covers proper DSN (Data Source Name) string generation and security tunnel setup for remote access.


## Overview

When working in a local development environment, you may need to connect databases running on your local machine to QueryPie AI Hub.

```mermaid
---
config:
  look: handDrawn
  theme: neutral
---

graph TB
    subgraph YourComputer ["üíª Your Local PC"]
        LocalDB[("Local Database<br/>(PostgreSQL, MySQL, Redis, etc.)")]
        TunnelService["Tunnel Service<br/>(ngrok etc.)"]
        LLMApp["LLM App<br/>(Cursor, Windsurf, etc.)"]
        
        LocalDB --> TunnelService
    end
    
    subgraph Internet ["üåê Internet"]
        QueryPieAIHub["QueryPie AI Hub"]
    end
    
    TunnelService -.->|"Secure Tunnel"| QueryPieAIHub
    LLMApp -.->|"Model Context Protocol"| QueryPieAIHub
    
    %% Styles
    style YourComputer fill:#f5f5f5,stroke:#333,stroke-width:2px
    style Internet fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style LocalDB fill:#e1f5fe,stroke:#1976d2
    style TunnelService fill:#fff3e0,stroke:#f57c00
    style LLMApp fill:#f3e5f5,stroke:#7b1fa2
    style QueryPieAIHub fill:#e8f5e8,stroke:#388e3c
```
To connect to a local database, please prepare the following items:

1. Local database instance (e.g., PostgreSQL, MySQL, Redis, etc.)
2. Tunnel service to make the local database accessible via the internet
3. Proper DSN string configuration


## Tunnel Service Options
You can use tunnel services like ngrok, Cloudflare Tunnel, etc.

### ngrok

A popular tunneling solution that provides additional features.

```bash filename="Install ngrok" copy
brew install ngrok
```

```bash filename="Create PostgreSQL tunnel" copy
ngrok tcp 5432
```

The DSN string can be entered as follows:

```bash filename="PostgreSQL DSN example" copy
postgresql://username:password@X.tcp.ngrok.io:XXXXX/dbname
```

### Cloudflare Tunnel

Cloudflare Tunnel is a free and stable tunneling service.

```bash filename="Install Cloudflare Tunnel" copy
brew install cloudflared
```

```bash filename="Create and run tunnel" copy
cloudflared tunnel --url tcp://localhost:5432
```

## Complete Setup Example

Let's look at a complete setup process using PostgreSQL and ngrok:

### 1. Start Local PostgreSQL Server
Ensure PostgreSQL is running on the default port 5432.
```bash filename="Step 1: Start PostgreSQL" copy
brew services start postgresql
```

### 2. Create ngrok Tunnel
Create a named tunnel.
```bash filename="Step 2: Create ngrok tunnel" copy
ngrok tcp 5432
```

When the tunnel is created, you'll see output like this:

```bash filename="ngrok output example" copy
Session Status                online
Account                       your-account (Plan: Free)
Version                       3.x.x
Region                        United States (us)
Latency                       -
Web Interface                 http://127.0.0.1:4040
Forwarding                    tcp://0.tcp.ngrok.io:12345 -> localhost:5432
```

### 3. Configure DSN String in QueryPie AI

Use the information provided in the ngrok output above to generate the DSN string:

```bash filename="Step 3: Configure DSN string" copy
postgresql://username:password@0.tcp.ngrok.io:12345/dbname
```

You can use this DSN string to add a database in QueryPie AI Hub.

## Security Considerations

When exposing local databases to the internet, always follow these guidelines:

- üîí Use strong passwords and usernames.
- üåê Allow connections only from known IP ranges.
- üîê Use SSL encrypted connections. QueryPie AI Hub also supports SSL connections.
- üìä Maintain and monitor database connection logs.
- ‚è±Ô∏è Use temporary tunnels during development and terminate them immediately after use.

## Troubleshooting

Here are common issues and solutions when using tunneling connections:

### 1. Connection Timeout
- Verify that the tunnel is running.
- Check if the local database allows external connections.
- Ensure firewall rules allow the connection.

### 2. Authentication Errors
- Verify database credentials.
- Check if the database user has appropriate permissions.
- Ensure the DSN string format is correct.

### 3. SSL/TLS Issues
- Configure SSL certificates if necessary.
- Add `sslmode=require` to the DSN string for secure connections.

### 4. Port Conflicts
- Check if other services are using the same port.
- Change to a different port if necessary.

## Roadmap: Tunneling
Tunneling functionality will be added to the local proxy in the future (planned for Q3 2025).<br/>
Through the tunneling functionality built into the local proxy, QueryPie AI Hub and user networks will be able to connect.<br/>
This will enable the following:
- Connect and use MCP Servers running on user networks
- If using QueryPie, safer DB, Server, Kubernetes access through QueryPie
- Even if not using QueryPie, support for DB, Server, Kubernetes access

![Tunneling CLI Client](@/app/img/tunneling-drawio-1.png)


## Additional Resources

- [ngrok Official Documentation](https://ngrok.com/docs)
- [Cloudflare Tunnel Documentation](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/) 