---
title: 'Google CloudからDBリソース同期'
---

import { Callout } from 'nextra/components'

# Google CloudからDBリソース同期

### Overview

QueryPieではデータベース登録および管理のためのGoogle Cloud（GCP）連動をサポートしています。GCP内のリソースを同期してQueryPieで管理するデータベースとして登録し、ユーザーおよびグループに同期して持ってきたデータベースに対するアクセス権限を付与し政策を設定できます。

### QueryPieでGCP連動情報登録

<Callout type="info">
11.3.0で特定のタグがあるリソースのみ同期できるようにSearch Filter機能が追加されました。
</Callout>

<figure data-layout="center" data-align="center">
![Administrator &gt; Databases &gt; Connection Management &gt; Cloud Providers](/administrator-manual/databases/connection-management/cloud-providers/synchronizing-db-resources-from-google-cloud/image-20241217-123654.png)
<figcaption>
Administrator &gt; Databases &gt; Connection Management &gt; Cloud Providers
</figcaption>
</figure>

1. Database設定メニューでCloud Providerメニューに移動します。
2. 右上の`Create Provider`ボタンをクリックします。
3. Name項目に該当プロバイダーを区分できる名前を入力します。
4. **Cloud Provider**項目でGoogle Cloud Platformを選択します。
5. **Project ID**項目で同期したいリソースのプロジェクトを入力します。
6. リソースを同期するために必要な**Credential**情報を入力します。
   * `Synchronize`ボタンクリック時にGCPのService Accountを入力する手動同期方式を基本提供します。<br/>QueryPie 10.2.2から「Save Credential for Synchronization」オプションを提供してCredential typeでService Accountを使用する時もスケジュールを通じた同期が可能になるように改善されました。
7. **Database Type Filter**項目で同期したいリソースを選択します。
8. **Search Filter**を使用して同期したい一部のタイプのリソースリストを取得できます。
   1. Search FilterはAWSの検索方式と同じように動作します。名前、ホスト、OS、タグなどの値をフィルターとして使用でき、以下の順序でEnterキーを活用して検索条件およびフィルターを便利に入力できます。
       1. Key値入力後Enter → 検索条件選択後Enter → Value値入力後Enter
9. **Replication Frequency**項目で同期方式を選択します。
   1. Manual : 同期をしたい時点にのみ手動で同期する方式です。
   2. Scheduling : 定期的なスケジューリングを通じてリソースを同期する方式です。Cron Expressionsを提供します。
9. **Auto Configuration Upon Initial Synchronization** Cloud Providerで最初に同期するDBの一部値をユーザーが指定できます。初期値設定はCloud Provider保存後修正できません。この設定の変更が必要な場合、Cloud Provider削除後再登録する必要があります。
   * Tag : 同期されたDBに自動でタグを追加できます。
     * タグ値に`{vpcid}`を入力すると、該当DBが属するCloudのVPC IDが自動で埋められます。
     * 例: タグKeyを"Network"に設定しValueを`{vpcid}`で入力すると、DBが"vpc-1a2b3c4d" VPCにある場合"Network: vpc-1a2b3c4d"タグが自動生成されます。
10. `Save`ボタンをクリックしてCloud Providerを保存します。

<Callout type="important">
**Save Credential for Synchronizationオプション**

<figure data-layout="center" data-align="center">
![Save Credential for Synchronization](/administrator-manual/databases/connection-management/cloud-providers/synchronizing-db-resources-from-google-cloud/image-20241220-094727.png)
<figcaption>
Save Credential for Synchronization
</figcaption>
</figure>

* **このオプションをアクティブにして保存した同期設定は同期設定詳細ページでこのオプションを非アクティブにできませんので慎重に選択する必要があります。保存されたcredentialは交換できません。他のcredentialを使用しなければならない状況なら同期設定を新しく作成する必要があります。credential変更が必要な場合は既存と同じ権限が割り当てられたcredentialを作成し同期設定を新しく作った後既存同期設定を削除することをお勧めします。**
* このオプションがアクティブになっていない状態で保存された同期設定は詳細ページでチェックボックスをチェックすることでオプションをアクティブにできます。
* このオプションがアクティブになっていれば同期を手動ですることもでき、スケジュールを指定することもできます。
</Callout>

### 登録されたGCP Cloud Provider同期および管理

<figure data-layout="center" data-align="center">
![Administrator &gt; Databases &gt; Connection Management &gt; Cloud Providers &gt; Details](/administrator-manual/databases/connection-management/cloud-providers/synchronizing-db-resources-from-google-cloud/image-20241220-095231.png)
<figcaption>
Administrator &gt; Databases &gt; Connection Management &gt; Cloud Providers &gt; Details
</figcaption>
</figure>

1. Database設定メニューでCloud Providerメニューに移動します。
2. 登録したCloud Providerをクリックして詳細情報画面に入ります。
3. 右上の`Sychronize`ボタンをクリックするとGCPからリソースを同期できます。
4. 表示されるSynchronization Logで同期進行状況を確認でき、Administrator &gt; General &gt; Systems &gt; Jobsメニューでも同期履歴を確認できます。
5. Cloud Providerを一度登録した後はProvider基本情報および認証情報は変更できません。
   1. Name: 変更可能
   2. Cloud Provider: 変更不可
   3. Project ID: 変更不可
   4. Credential: 変更不可
      1. "Save Credential for Synchronization" : 非アクティブ状態はアクティブに変更できますが、アクティブ状態を非アクティブに転換不可
   5. Database Type Filter: 変更可能
   6. Replication Frequency: 変更可能

<Callout type="important">
"Save Credential for Synchronization"オプションがアクティブになっていない状態で保存された同期設定は詳細ページでチェックボックスをチェックすることでオプションをアクティブにできます。新しく作成する時と同様にこの設定は**アクティブにした後再び非アクティブにできませんので**慎重に選択する必要があります。
</Callout>

### Service Accountを通じた同期

1. GCP連動のためのCloud Provider登録後、詳細ページで`Synchronize`ボタンをクリックします。
2. 表示されるService Account JSON項目にJSONキー値を入力後`Ok`ボタンをクリックします。
   * Service AccountはGoogle Cloudコンソール &gt; IAMおよび管理者 &gt; サービスアカウントメニューで作成後JSONキーを発行して使用できます。
3. 該当JSONキーで同期されたリソースはDB Connectionsメニューで確認できます。

<Callout type="info">
**GCPでService Accountを作成する時に以下の権限が必要です。**
* CloudSQL : CloudSQL Viewer
* BigQuery : BigQuery Administrator
</Callout>


