---
title: 'サーバーをグループで管理'
---

import { Callout } from 'nextra/components'

# サーバーをグループで管理

### Overview

数多くのサーバーをグループ化してアクセス可能なアカウントおよびポリシーを一度に適用できます。目的に応じてサーバーグループを作成した後、一括でポリシーを便利に管理でき、このようにグループ化したサーバーグループ権限を個別ユーザーまたはユーザーグループに一度に付与できます。

<Callout type="info">
サーバーグループ登録に必要な各リソースを事前に登録することをお勧めします。
1. Administrator &gt; Servers &gt; Server Account Management &gt;  **Server Account Templates**
2. Administrator &gt; Servers &gt; Server Account Management &gt;  **SSH Key Configurations**
</Callout>


### サーバーグループ作成

<figure data-layout="center" data-align="center">
![Administrator &gt; Servers &gt; Connection Management &gt; Server Groups &gt; Create Server Group](/administrator-manual/servers/connection-management/server-groups/managing-servers-as-groups/image-20250123-113012.png)
<figcaption>
Administrator &gt; Servers &gt; Connection Management &gt; Server Groups &gt; Create Server Group
</figcaption>
</figure>


1. Administrator &gt; Servers &gt; Connection Management &gt; Server Groupsメニューに移動します。
2. 右上の`+ Create Group`ボタンをクリックします。
3. グループ作成のための以下の情報を入力します。
    1.  **Name** : サーバーグループを画面で区別できる名前です。
    2.  **Description** : 該当サーバーグループに対する付加的な説明を入力できます。
    3.  **Server Tags** : 該当サーバーグループに含まれるサーバーをServer Tagsを通じてフィルタリングして追加します。
4. `Save`ボタンを通じて保存します。

<Callout type="info">
サーバーグループはTagベースでサーバーを管理できます。特定TagをサーバーグループのServer Tagsに指定して、該当Tagがあるすべてのサーバーがサーバーグループに含まれる形態の流動的なサーバー管理が可能です。
</Callout>


### サーバーグループ作成/修正

以下の情報を入力してサーバーグループを作成できます。作成後、一部項目は修正が可能です。

#### 1. 基本情報入力およびサーバーをTagで追加

<figure data-layout="center" data-align="center">
![image-20240902-045749.png](/administrator-manual/servers/connection-management/server-groups/managing-servers-as-groups/image-20240902-045749.png)
</figure>

* Name : サーバーグループの名前を入力します。
* Description : サーバーグループを説明できる内容を入力します。複数の管理者がいる場合、サーバーグループ間の簡単な識別のために目的に合わせて名前および説明を詳細に入力することをお勧めします。
* Server Tags : サーバーグループでまとめたいサーバーのタグを指定して流動的にサーバーグループの対象を管理できます。タグを通じて追加されたサーバーはサーバーテーブルで手動削除ができず、Server Tagsのタグを修正しなければなりません。

#### 2. Serverを手動で追加

<figure data-layout="center" data-align="center">
![image-20241028-003400.png](/administrator-manual/servers/connection-management/server-groups/managing-servers-as-groups/image-20241028-003400.png)
</figure>

* Serversでは該当サーバーグループに属するサーバーを確認したり、サーバーをサーバーグループに手動追加できます。
    * 右上の`Add Server`ボタンをクリックすると画面上部にサーバーリストを確認できるポップアップが表示されます。
    * 該当ポップアップ窓でサーバーグループに追加する個別サーバーを選択後`Add`ボタンをクリックします。
        * ポップアップ内フィルター(:フィルター:)機能を利用して複数の条件でサーバーをフィルタリングできます。
        * 最終該当サーバーグループに追加されたサーバーを確認できます。
* InformationのServer Tagsで手動追加されたサーバーと関連するタグを削除しても、手動で追加されたサーバーはサーバーグループから除外されません。Serversテーブルでチェックボックス選択後表示される`Delete`ボタンを通じた手動削除のみ可能です。
* Test Connectionを通じてServer Group内追加されたServerとAccountに対するアカウント情報確認ができます。
    * Test Connectionを使用するには最小1個のServerとAccountをServer Groupに追加する必要があります。

<Callout type="info">
Test ConnectionはServer Groupを保存した後にのみ使用できます。
</Callout>

#### 3. Accounts登録

<figure data-layout="center" data-align="center">
![Screenshot-2025-07-27-at-10.33.48-PM.png](/administrator-manual/servers/connection-management/server-groups/managing-servers-as-groups/Screenshot-2025-07-27-at-10.33.48-PM.png)
</figure>

1. 該当コネクションにアクセス時に必要なAccountを登録し、管理します。Accountを登録する方法は2つあります。
    1. `Copy`ボタンを押してServer Account Templatesメニューで既に登録したAccountを一度に読み込めます。
        1. Sever Account Templateを登録する方法は[Server Account Templates](../../server-account-management/server-account-templates)を参考にします。
    2. または`Add Account`機能を利用して手動でAccountを追加できます。
        1. `Add Account`ボタンクリック時、アカウント設定のためのモーダル窓が表記されます。選択したCategoryごとに入力しなければならない項目が異なります。
2. Provisioningアカウントで指定されたアカウントはAccount横に鍵アイコンが表示されます。
3. カテゴリ別でアカウントを設定できます。
    1. Category : 最も先にアカウントの認証方式とタイプを定義するCategoryを選択する必要があります。選択するCategoryに応じて下段に表示される設定項目が動的に変更されます。
    2.  **注意** : アカウントを作成した後はCategoryを修正できませんので慎重に選択する必要があります。
4. Category別設定項目
    1.  **QueryPie内部認証**
        1. `QueryPie - Manual Login` : サーバーアクセス時にユーザーが設定されたアカウントのパスワードを直接入力します。
            * 入力が必要な項目 : Account
        2. `QueryPie - Password` : QueryPieに保存されたパスワードを使用して自動ログインします。
            * 入力が必要な項目 : Account, Password
            * Admin &gt; Servers &gt; Configurations &gt; Using One Time Accounts活性化時、Set As Provisioning Accountチェックボックスチェック可能
        3. `QueryPie - SSH Key` : QueryPieに登録されたSSH Keyを使用して自動ログインします。
            * 入力および選択が必要な項目 : Account, SSH Key
            * Admin &gt; Servers &gt; Configurations &gt; Using One Time Accounts活性化時、Set As Provisioning Accountチェックボックスチェック可能
        4. `QueryPie - Custom Account` : サーバーアクセス時に事前に登録されたアカウントの代わりに、ユーザーがアカウント情報を直接入力してアクセスできるように許可します。ユーザーはアクセス時点に露出される入力フィールドにアカウントとパスワードを手動で入力する必要があります。
            * 入力が必要な項目 : Alias
            * Seamless SSH方式ではCustom Accountアクセスをサポートしません。
            * Server AgentがインストールされたWindows ServerではCustom Accountアクセスをサポートしません。
            * Server AgentがないWindows ServerではCustom Accountでのみアクセスできます。
    2.  **ProvisioningおよびOne Time Account**
        1. Admin &gt; Servers &gt; ConfiguresでPassword ProvisioningとUsing One Time Accountsが活性化されていなければカテゴリ項目が表示されます。
        2. `QueryPie - Provisioning` : QueryPieに登録されたアカウントをProvisioning用途で使用します。
            * 入力が必要な項目 : Account
            * Admin &gt; Servers &gt; Configurations &gt; Using One Time Accounts活性化時、Set As Provisioning Accountチェックボックスチェック可能
        3. `Active Directory - Provisioning` : Active DirectoryアカウントをProvisioning用途で使用します。
            * 入力および選択が必要な項目 : Account, Secret Store
        4. `QueryPie - One Time Account` : ユーザーがサーバーにアクセスする期間のみ有効な一回用一時アカウントのための用途で使用します。
            * 入力が必要な項目 : Account
            * 必須条件: One Time Accountを使用するには必ずサーバーグループ内にProvisioningアカウントがまず指定されていなければなりません。
    3.  **Secret Store連携 (Hashicorp Vault)**
        1. Admin &gt; General &gt; Security &gt; Secret Storesが活性化されていなければカテゴリ項目が表示されます。
        2. `Vault - K/V - Password` **** : Vault K/Vエンジンに保存されたパスワードを使用します。
            * 入力および選択が必要な項目 : Alias, Secret Store, Account Path, Password Path
                * Secret Store : エンジンタイプがK/Vタイプの項目のみフィルタされて表記されます。
            * サーバーグループにAccount情報登録時、Secret Store連携情報を活用すると事前指定されたSecret Store認証情報連携を通じてコネクションにアクセスできます。事前にサーバー認証情報をSecret Storeに保存し、サーバーリモートアクセス時にユーザーがSecret Storeに保存されたサーバー認証情報を活用してアクセスすることで、サーバー認証情報に対するセキュリティを強化できます。Server Groupsが指定されたServerはServer Groupsと同じSecret Storeを使用するように強制されます。
            * Alias項目に利用者たちに露出されるサーバーアカウント名を入力します。
        3. `Vault - K/V - SSH Key` **** : Vault K/Vエンジンに保存されたSSH Keyを使用します。
            * 入力および選択が必要な項目 : Alias, Secret Store, Account Path, SSH Key Path
                * Secret Store : エンジンタイプがK/Vタイプの項目のみフィルタされて表記されます。
        4. `Vault - SSH - OTP` **** : VaultのSSH OTPエンジンを使用します。
            * 入力および選択が必要な項目: Account, Secret Store, Vault Role Path
                * Secret Store : エンジンタイプがOTPタイプの項目のみフィルタされて表記されます。
            * Hashicorp VaultのSSH OTPエンジンを使用して、Passwordless形態でサーバーアカウントを管理できます。ただし、サーバーにvaultのserver agentであるvault-ssh-helperをインストールする必要があります。詳細ガイドは[Hashicorp Vault公式ガイド](https://developer.hashicorp.com/vault/tutorials/secrets-management/ssh-otp)を参考にしてください。
        5. `Vault - SSH - CA` **** : VaultのSSH CAエンジンを使用します。
            * 入力および選択が必要な項目: Account, Secret Store, Vault Role Path
                * Secret Store : エンジンタイプがCAタイプの項目のみフィルタされて表記されます。
            * Hashicorp VaultのSSH CAエンジン(Signed SSH certificates)を使用して、Passwordless形態でサーバーアカウントを管理できます。ただし、vault caエンジンで発行したPublic KeyをアクセスするサーバーのTrustedUserCAKeysに追加する必要があります。詳細ガイドは[Hashicorp Vault公式ガイド](https://developer.hashicorp.com/vault/docs/secrets/ssh/signed-ssh-certificates)を参考にしてください。

<Callout type="info">
**共通項目: Account**
* 個別アカウントを区別できる名前を入力します。
    1. `{username}`を入力する場合、権限を受けた利用者がQueryPieでサーバーアクセス時、QueryPieのusernameで置換されます。
    2. usernameがemail形態になっている場合、`{username_prefix}`で入力するとQueryPieのusernameの接頭辞(@前の部分)で置換されます。
</Callout>

<Callout type="info">
**参考: Vault Role Path**
Vault SSH-OTPおよびSSH-CA認証方式ではVault Role PathフィールドにVaultに設定された特定Roleにアクセスするための全体APIパス(例: エンジンパス/creds/ロール名)を入力する必要があります。
</Callout>

<Callout type="info">
**参考: QueryPie - Custom Account**
* Seamless SSHアクセス方式ではこの機能をサポートせず、アクセス試行時「Custom account not supported on seamless SSH」エラーメッセージが表示されます。
* Admin &gt; Audit &gt; Server Access Historyにはアクセスに使用されたAliasが記録されます。SSHアクセスの場合、ユーザーが入力したアカウント名も一緒に記録されますが、Server AgentがないWindows RDPアクセス時にはAliasのみ記録されます。
</Callout>

<Callout type="info">
provisioning accountは実際のサーバーに登録されたアカウントでなければならず、以下のような設定が必要です。
* アカウント作成/削除権限が必須です。
* sudoを使う時、パスワードを入力しないように設定されていなければなりません。
</Callout>

<Callout type="info">
macOSのVNCプロトコル制限により、VNCを通じた自動ログインを遮断します。
したがって、QueryPieでmacOSサーバーアクセス時、VNC接続後ユーザーが直接ログイン情報を入力する必要があります。
</Callout>

<Callout type="info">
**VaultでRoleを設定する時、**
*  **Default extensions** に以下の値を入力する必要があります。
    * 
*  **TTL / Max TTL** 設定時、60以上に設定します。
    * QueryPieでは証明書のTTL(Time To Live)は60秒です。
*  **Signing Algorithm** はras-sha2-256で設定します。
</Callout>

#### 4. Server Group Owner登録

<figure data-layout="center" data-align="center">
![image-20250512-105127.png](/administrator-manual/servers/connection-management/server-groups/managing-servers-as-groups/image-20250512-105127.png)
</figure>

サーバーグループオーナーを登録してWorkflowの承認者で指定できます。

1. 右上の`Assign Owners`ボタンをクリックするとUserおよびUser Groupを表示するポップアップが表示されます。
2. 該当ポップアップ窓でサーバーグループオーナーで指定するUserまたはUser Groupを選択後`Save`ボタンをクリックします。
3. 該当サーバーグループにオーナーで指定されたUserまたはUser Groupを確認できます。
4. `Save Changes`ボタンを通じて保存します。


#### 5. Server Group Member登録

<figure data-layout="center" data-align="center">
![image-20250512-105142.png](/administrator-manual/servers/connection-management/server-groups/managing-servers-as-groups/image-20250512-105142.png)
</figure>

サーバーグループメンバーを登録して利用者別Workflowで表示されるServer Groupを指定できます。

1. 右上の`Assign Members`ボタンをクリックするとUserおよびUser Groupを表示するポップアップが表示されます。
2. 該当ポップアップ窓でサーバーグループメンバーで指定するUserまたはUser Groupを選択後`Save`ボタンをクリックします。
3. 該当サーバーグループにメンバーで指定されたUserまたはUser Groupを確認できます。
4. `Save Changes`ボタンを通じて保存します。

<Callout type="info">
Workflowで表示されるServer Groupを制限するにはAdmin &gt; Servers &gt; General &gt; Configurationsで「Show Server Groups in Workflow if Assigned as Member」項目を活性化する必要があります。詳細位置は[Server Access Request Default Settings | 基本-サーバー-アクセス-ポリシー-設定](../../sac-general-configurations#%ea%b8%b0%eb%b3%b8-%ec%84%9c%eb%b2%84-%ec%a0%91%ea%b7%bc-%ec%a0%95%ec%b1%85-%ec%84%a4%ec%a0%95)ガイドを参考にお願いします。
</Callout>
