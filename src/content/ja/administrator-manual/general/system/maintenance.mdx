---
title: 'Maintenance'
---

import { Callout } from 'nextra/components'

# Maintenance

### Overview

QueryPieのバージョンアップグレード作業を行う場合、QueryPieが記録するLog DBは大容量でバックアップが困難で、主要機能がアップグレード中にも記録を停止しないようにするには適切なサービス提供レベルの制御が必要です。これにメンテナンスモードを設定してマイグレーション作業を実行します。

参考として、QueryPieサーバーが2台のサーバーで冗長化されている場合のアップグレード手順は以下の通りです。

1.  **準備** : 最新パッケージダウンロードおよび設定ファイルを確認します。
2.  **メンテナンスモード設定** : 作業告知後、システムのサービスアクセスレベルを制限します。
3.  **データベース準備** : 新バージョン用スキーマを生成し、既存データを複製します。
4.  **2番サーバーアップグレード** : LBから2番サーバーを分離し、マイグレーションおよび2番サーバーに新バージョンをインストールします。
5.  **2番サーバーテスト** : 2番サーバーに直接アクセスしてアップグレード結果を確認します。
6.  **1番サーバーアップグレード** : LBに2番サーバーを再接続し、1番サーバーを分離した後、1番サーバーに新バージョンをインストールします。
7.  **最終転換** : LBに1番サーバーを再接続して全体サービスアップグレードを終了します。

<Callout type="info">
メンテナンスモード設定機能は11.3.0に追加されました。
</Callout>

### メンテナンスモード（Operation Mode）設定

<Callout type="important">
サービス全体に対する影響を与えるため、慎重に決定して作業を進行する必要があります。
</Callout>

<figure data-layout="center" data-align="center">
![Admin &gt; General &gt; System &gt; Maintenance](/administrator-manual/general/system/maintenance/image-20250928-205515.png)
<figcaption>
Admin &gt; General &gt; System &gt; Maintenance
</figcaption>
</figure>

設定できるModeは以下の通りです。

|  **Mode**        |  **説明**                                                                                                                                     |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| Read Only        | ユーザーがLoginは可能だが、照会を除く他の機能は使用できません。（Read Only状態に転換された後、最初のコマンド実行は実行され、Audit Logに記録されますが、2番目のコマンドからは実行されず、Audit Logも記録されません。） |
| Active Session   | 既に存在するセッションではコマンド実行が可能だが、新しいセッションは照会を除くコマンド実行ができません。（DAC / SAC / WACに適用不可）                                                      |
| Allow Connection | 既に存在するセッションと新しいセッションでコマンド実行が可能だが、Workflow上申や設定修正などの作業は許可されません。（KAC / WACに適用不可）                                                  |
| Full Access      | 一般的な平時の動作モードです。                                                                                                                         |
