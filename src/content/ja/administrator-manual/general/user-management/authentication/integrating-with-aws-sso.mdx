---
title: 'AWS SSO連携'
---

## Overview

QueryPieではAWS IAM Identity Centerのユーザーを複数のクラウドアプリケーションおよびSAML 2.0を通じてユーザー連携をサポートします。ユーザーを同期してアクセス権限を付与しポリシーを適用できます。

## AWS IAM Identity CenterでQueryPieをアプリケーションとして追加

<figure data-layout="center" data-align="center">
![AWS-SSO-01-20230317-044219.png](/administrator-manual/general/user-management/authentication/integrating-with-aws-sso/AWS-SSO-01-20230317-044219.png)
</figure>

1. [AWS IAM Identity Center](https://ap-northeast-2.console.aws.amazon.com/singlesignon/applications/home)にアクセスします。
2. 左側メニューのアプリケーションメニューに進入します。
3. 右上のアプリケーション追加ボタンをクリックします。
4. ユーザー指定SAML 2.0アプリケーション追加オプション選択後次ボタンをクリックします。
5. アプリケーション構成 &gt; 表示名にQueryPieを入力します。
6. アプリケーション属性 &gt; アプリケーション開始URL項目にQueryPieがインストールされたドメインアドレスを以下のように入力します。
    1. アプリケーションStart URL : https://`{querypie_host}`/saml/login
7. アプリケーションメタデータ項目にそれぞれ以下のように入力します。
    1. アプリケーションACS URL : https://`{querypie_host}`/saml/sp/acs
    2. アプリケーションSAML対象 : https://`{querypie_host}`/saml/sp/metadata
8. 提出ボタンをクリックして保存します。


## QueryPie連携のための属性マッピング設定

<figure data-layout="center" data-align="center">
![AWS-SSO-06-20230317-064023.png](/administrator-manual/general/user-management/authentication/integrating-with-aws-sso/AWS-SSO-06-20230317-064023.png)
</figure>

1. 生成されたアプリケーション右上で作業 &gt; 属性マッピング編集に移動します。
2. アプリケーション内ユーザー属性とマッピング値、形式を上スクリーンショットを参考にして以下のように入力します。

|  **アプリケーション内ユーザー属性**  |  **IAM Identity Centerの文字列値またはユーザー属性でマッピング**  |  **形式**      |
| --------------------- | ------------------------------------------------ | ------------ |
| Subject               | $`{user:email}`                                  | emailAddress |
| firstName             | $`{user:givenName}`                              | basic        |
| lastName              | $`{user:familyName}`                             | basic        |
| loginId               | $`{user:email}`                                  | basic        |
| email                 | $`{user:email}`                                  | basic        |

`変更事項保存`ボタンをクリックして保存します。

## QueryPieでAWS IAM Identity Center連携設定

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; User Management &gt; Authentication ](/administrator-manual/general/user-management/authentication/integrating-with-aws-sso/image-20240723-072112.png)
<figcaption>
Administrator &gt; General &gt; User Management &gt; Authentication
</figcaption>
</figure>

1. Administrator &gt; General &gt; User Management &gt; Authenticationメニューに移動します。
2. 認証Type項目で**SAML**を選択します。
3. アプリケーション &gt; 作業 &gt; 構成編集画面でIAM Identity Center SAMLメタデータファイルをダウンロードします。
4. ダウンロードしたXML情報をIdentity Provider Metadata項目に貼り付けます。
5. `Save Changes`ボタンをクリックして保存します。

## QueryPieでSAMLログイン

<figure data-layout="center" data-align="center">
![image-20240723-073353.png](/administrator-manual/general/user-management/authentication/integrating-with-aws-sso/image-20240723-073353.png)
</figure>

これでログインページで`Login with SAML`ボタンを通じてAWS認証してQueryPieにログインできます。


