---
title: 'AWS EKS 환경에서 설치하기'
confluenceUrl: 'https://querypie.atlassian.net/wiki/spaces/QM/pages/815235967/AWS+EKS'
---

import { Callout } from 'nextra/components'

# AWS EKS 환경에서 설치하기

## 1. 개요

### 1.1 목적

* AWS EKS 클러스터에 QueryPie ACP를 Helm Chart로 설치하는 전체 과정 안내
* Demo 모드(빠른 시작)와 Production 모드(외부 관리형 DB) 설치 방법 제공

### 1.2 대상 독자

* Kubernetes 기본 개념(Pod, Service, Deployment 등)을 이해하고 있는 엔지니어
* AWS EKS 사용 경험이 있는 엔지니어

## 2. 아키텍처

### 2.1 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────┐
│                         AWS Cloud                               │
│                                                                 │
│    ┌─────────────────┐         ┌─────────────────┐              │
│    │    Route53      │         │      ACM        │              │
│    │ (DNS Records)   │         │ (TLS Certificate)│             │
│    └────────┬────────┘         └────────┬────────┘              │
│             │                           │                       │
│             ▼                           ▼                       │
│    ┌─────────────────────────────────────────────┐              │
│    │        ALB (Application Load Balancer)      │              │
│    │           HTTPS:443 termination             │              │
│    └─────────────────────┬───────────────────────┘              │
│                          │                                      │
│    ┌─────────────────────┴───────────────────────┐              │
│    │              EKS Cluster                    │              │
│    │  ┌───────────────────────────────────────┐  │              │
│    │  │      AWS Load Balancer Controller     │  │              │
│    │  │           (Ingress Controller)        │  │              │
│    │  └───────────────────┬───────────────────┘  │              │
│    │                      │                      │              │
│    │  ┌───────────────────┴───────────────────┐  │              │
│    │  │         Namespace: querypie           │  │              │
│    │  │  ┌─────────────────────────────────┐  │  │              │
│    │  │  │      QueryPie StatefulSet       │  │  │              │
│    │  │  │         (querypie-0)            │  │  │              │
│    │  │  └──────────────┬──────────────────┘  │  │              │
│    │  │                 │                     │  │              │
│    │  │       ┌─────────┴─────────┐           │  │              │
│    │  │       ▼                   ▼           │  │              │
│    │  │  ┌─────────┐        ┌─────────┐       │  │              │
│    │  │  │  MySQL  │        │  Redis  │       │  │              │
│    │  │  │ (Demo)  │        │ (Demo)  │       │  │              │
│    │  │  └─────────┘        └─────────┘       │  │              │
│    │  └───────────────────────────────────────┘  │              │
│    └─────────────────────────────────────────────┘              │
│                                                                 │
│    ┌─────────────────┐                                          │
│    │  NLB (Proxy)    │  ← User Agent 연결용                      │
│    │  TCP: 9000,     │    (DAC/SAC/KAC/WAC)                      │
│    │  6443, 7447     │                                          │
│    └─────────────────┘                                          │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 구성 요소

| 구성 요소 | 설명 |
|----------|------|
| ALB (Application Load Balancer) | HTTPS 트래픽 처리, ACM 인증서로 TLS 종료 |
| NLB (Network Load Balancer) | User Agent 연결용 TCP 트래픽 처리 (9000, 6443, 7447 포트) |
| AWS Load Balancer Controller | Kubernetes Ingress를 ALB/NLB로 프로비저닝 |
| QueryPie StatefulSet | QueryPie 애플리케이션 컨테이너 |
| MySQL (Demo) | 메타데이터 저장소 (Demo 모드에서 자동 배포) |
| Redis (Demo) | 세션 및 캐시 저장소 (Demo 모드에서 자동 배포) |

## 3. 설치 방식 선택

QueryPie EKS 설치는 두 가지 모드를 지원합니다.

### 3.1 Demo 모드 (권장: PoC/테스트 환경)

Helm Chart의 `demo.enabled: true` 옵션을 사용하여 MySQL과 Redis를 EKS 클러스터 내에 자동 배포합니다.

**장점:**
* 빠른 설치 (외부 DB 설정 불필요)
* 단일 Helm 명령으로 전체 스택 배포
* PoC, 데모, 개발 환경에 적합

**제약:**
* 단일 노드 DB (고가용성 미지원)
* 데이터 백업/복구는 수동 관리 필요

### 3.2 Production 모드

외부 관리형 데이터베이스를 사용합니다.

**권장 구성:**
* MySQL: Amazon RDS for MySQL 또는 Aurora MySQL
* Redis: Amazon ElastiCache for Redis

**장점:**
* 고가용성 및 자동 백업
* 독립적인 DB 스케일링
* 프로덕션 환경에 적합

## 4. 사전 요구사항

### 4.1 EKS 클러스터 요구사항

| 항목 | 요구사항 |
|------|---------|
| Kubernetes 버전 | 1.24 이상 |
| 노드 타입 | m7i.xlarge (4 vCPU, 16GB RAM) 이상 권장 |
| 노드 수 | 최소 2개 (프로덕션 환경은 3개 이상 권장) |

<Callout type="warning">
**메모리 설정 주의사항**

m7i.xlarge 노드(16GB RAM)의 실제 allocatable memory는 약 15Gi입니다.
Helm values에서 메모리를 16Gi로 설정하면 `Insufficient memory` 에러가 발생합니다.
Demo/PoC 환경에서는 8Gi 설정을 권장합니다.
</Callout>

### 4.2 필수 AWS 구성 요소

EKS 클러스터에 QueryPie를 설치하기 전에 다음 AWS 리소스를 구성해야 합니다:

| 구성 요소 | 설명 | 필수 여부 |
|----------|------|----------|
| OIDC Provider | IAM Role과 Kubernetes Service Account 연동 | 필수 |
| EBS CSI Driver | PersistentVolume 프로비저닝 | 필수 |
| AWS Load Balancer Controller | ALB/NLB Ingress 프로비저닝 | 필수 |
| ACM 인증서 | HTTPS 통신용 TLS 인증서 | 권장 |

<Callout type="important">
위 구성 요소가 없으면 PersistentVolume 생성 실패, ALB 미생성 등의 문제가 발생합니다.
[Part 1: AWS 환경 설정](installing-on-aws-eks-part1-aws-setup) 가이드를 먼저 완료하세요.
</Callout>

### 4.3 로컬 환경 준비사항

**필수 도구:**

```bash
# AWS CLI
brew install awscli

# eksctl (EKS 관리 도구)
brew tap weaveworks/tap
brew install weaveworks/tap/eksctl

# kubectl
brew install kubectl

# Helm (버전 3.10.0 이상 필수)
brew install helm
```

**AWS 자격 증명 설정:**

```bash
# AWS 자격 증명 확인
aws sts get-caller-identity

# EKS 클러스터 kubeconfig 설정
aws eks update-kubeconfig --name <cluster-name> --region <region>

# 클러스터 연결 확인
kubectl get nodes
```

### 4.4 네트워크 요구사항

자세한 네트워크 포트 정보는 [시스템 아키텍처와 네트워크 접근제어](../system-architecture-and-network-access-control) 문서를 참조하세요.

## 5. 설치 가이드

설치는 두 단계로 진행됩니다:

### Part 1: AWS 환경 설정

EKS 외부의 AWS 리소스(OIDC Provider, EBS CSI Driver, ALB Controller, ACM 인증서)를 구성합니다.

**[Part 1: AWS 환경 설정 가이드로 이동](installing-on-aws-eks-part1-aws-setup)**

### Part 2: Helm 배포

Kubernetes 리소스를 생성하고 QueryPie를 Helm Chart로 배포합니다.

**[Part 2: Helm 배포 가이드로 이동](installing-on-aws-eks-part2-helm-deployment)**

## 6. 설치 후 설정

설치가 완료되면 다음 설정을 진행합니다.

### 6.1 라이선스 설치

QueryPie 웹 콘솔에 처음 접속하면 라이선스 입력 화면이 표시됩니다.
PEM 형식의 라이선스를 입력하여 제품을 활성화합니다.

자세한 내용은 [라이선스 설치](../license-installation) 문서를 참조하세요.

### 6.2 기본 설정

라이선스 활성화 후 다음 설정을 진행합니다:

* **QueryPie Web Base URL 설정**: Admin Page → General에서 외부 접근 URL 설정
* **Proxy 주소 설정**: DAC/SAC, KAC, WAC 기능별 Proxy 접속 주소 설정

자세한 설정 절차는 [설치 가이드 - setup.v2.sh](installation-guide-setupv2sh#기본-설정-절차) 문서의 "기본 설정 절차" 섹션을 참조하세요.

## 7. 참고 자료

* [QueryPie Helm Chart GitHub](https://github.com/chequer-io/querypie-deployment)
* [제품 버전](../product-versions)
* [컨테이너 환경변수](../container-environment-variables)
* [Amazon EKS 문서](https://docs.aws.amazon.com/eks/)
* [AWS Load Balancer Controller 문서](https://kubernetes-sigs.github.io/aws-load-balancer-controller/)
