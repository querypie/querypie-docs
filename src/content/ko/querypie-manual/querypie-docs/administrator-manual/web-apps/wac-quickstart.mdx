import { Callout } from 'nextra/components'

QueryPie 홈페이지를 예시로 가장 간단한 WAC 사용법을 안내하겠습니다.

1. QueryPie 홈페이지를 웹 앱으로 등록하고 Resources 하위의 일부 메뉴를 하위 경로로 등록합니다.
2. 등록된 하위 경로에 대해서만 접근을 허용하는 정책(Policy)과 역할(Role)을 만들어봅니다.
3. 현재 사용자에게 이 역할을 할당하고 웹 앱 접근 제어의 동작을 확인합니다.

<Callout type="info">
**안내** 
Quickstart는 `10.2.8` 버전을 기준으로 설명합니다. 
이 Quickstart를 따라하려면 QueryPie 관리자 권한 중 Owner 또는 Web App Admin 권한이 필요합니다. 
</Callout>

# Admin-side
## 1. 웹 앱 등록하기
QueryPie 홈페이지(www.querypie.com) 내 /ko/resources 하위 구조는 다음과 같습니다.

이 퀵스타트 가이드에서는 이 중 일부 경로만을 웹 앱 하위에 등록한 뒤, 등록된 경로만 접근을 허용하는 정책을 생성하겠습니다.

```
/ko/resources/
├── discover/
│   ├── blog/ (등록)
│   ├── webinars/ (등록)
│   ├── white-paper/ (등록)
│   ├── certifications/
│   └── integrations/
│
└── learn/
    ├── documentation/ (등록)
    ├── tutorials/ (등록)
    └── demo/
```

1. Admin > Web Apps > Connection Management > Web Apps 메뉴로 진입하세요.
2. Create a Web App 버튼을 클릭하면 웹 앱 등록 페이지로 진입합니다.

<p align="center">
<div>[스크린샷 2025-04-12 오후 10.56.20.png]()</div>
*Admin &gt; Web Apps &gt; Create a Web App*
</p>

다음의 정보를 입력하세요.

1. Name : QueryPie Web Site
2. Base URL : www.querypie.com 또는 10.10.10.10:443 Base URL에 하위 경로(예: /ko)를 포함할 수 없습니다.Base URL 입력시 https:// 는 제외하는 것을 권장합니다.
  1. Base URL에 하위 경로(예: /ko)를 포함할 수 없습니다.
  2. Base URL 입력시 https:// 는 제외하는 것을 권장합니다.
3. Description : 웹 앱에 대한 설명을 입력하세요. (예: 쿼리파이 웹사이트)
4. Watermark : 웹 앱 접속 시 사용자의 브라우저 화면에 워터마크를 적용할지 여부를 선택합니다.웹 앱 접속시 브라우저에 접속자, 접속일시 등의 정보를 표시함으로써 화면 유출을 방지합니다.가이드에서는 On 상태를 가정하고 안내하겠습니다.
  1. 웹 앱 접속시 브라우저에 접속자, 접속일시 등의 정보를 표시함으로써 화면 유출을 방지합니다.
  2. 가이드에서는 On 상태를 가정하고 안내하겠습니다.
5. URL Paths : 하위 경로를 입력합니다. (선택) 가이드에서는 하위 경로를 입력해보겠습니다. + Add Path 버튼을 클릭하여 하위 경로를 입력해주세요.
  1. 가이드에서는 하위 경로를 입력해보겠습니다. + Add Path 버튼을 클릭하여 하위 경로를 입력해주세요.

| Path                                 | Path Tag     |
| ------------------------------------ | ------------ |
| /ko                                  | for:landing  |
| /ko/resources/discover/blog/*        | for:discover |
| /ko/resources/discover/webinars/*    | for:discover |
| /ko/resources/discover/white-paper/* | for:discover |
| /ko/resources/learn/documentation/*  | for:learn    |
| /ko/resources/learn/tutorials/*      | for:learn    |

이어서 나머지 정보를 입력합니다.

1. User Activity Recording : 사용자 행위 기록 여부On으로 활성화 후 모든 옵션을 켜주세요.Excluded URL Paths는 사용자 행위 기록을 제외할 경로를 입력합니다. 여기서는 비워 둡니다.
  1. On으로 활성화 후 모든 옵션을 켜주세요.
  2. Excluded URL Paths는 사용자 행위 기록을 제외할 경로를 입력합니다. 여기서는 비워 둡니다.
2. Tag : 웹 앱에 대한 태그입니다. 여기서는 비워 둡니다.
3. Save 버튼을 눌러 저장합니다.

## 2. 정책 등록하기
다음으로 QueryPie 웹 사이트에 대하여, 등록된 하위 경로에만 접속을 허용하는 정책을 만들어봅니다.

<p align="center">
<div>[스크린샷 2025-04-12 오후 11.07.27.png]()</div>
*Admin &gt; Web Apps &gt; Web App Access Control &gt; Policies &gt; Edit Policy Code*
</p>

1. Admin > Web Apps > Web App Access Control > Policies 메뉴로 진입하세요.
2. Create Policy 버튼을 클릭하고, Create Policy 모달에 다음을 입력하세요.Name : QP Web Test
  1. Name : QP Web Test
3. Save 버튼을 클릭하여 저장합니다.
4. 방금 생성한 QP Web Test 정책을 클릭하여 상세 페이지로 진입하고, Go to Editor Mode 버튼을 클릭합니다.
5. 에디터에 다음 내용을 복사 후 붙여넣습니다.

```
apiVersion: webApp.rbac.querypie.com/v1
kind: WacPolicy

spec:
  allow:
    resources:
      - webApp: "QueryPie Web Site"
        urlPaths:
          - "/ko"
          - "/ko/resources/discover/blog/*"
          - "/ko/resources/discover/webinars/*"
          - "/ko/resources/discover/white-paper/*"
          - "/ko/resources/learn/documentation/*"
          - "/ko/resources/learn/tutorials/*"
```

1. Save Changes 버튼을 클릭하고, 사유 입력 모달에서 OK 버튼을 눌러 저장합니다.

## 3. 역할 생성하기
이제 새로운 역할을 생성하고, 앞에서 만든 정책을 할당하겠습니다.

<p align="center">
<div>[스크린샷 2025-03-30 오후 8.49.11.png]()</div>
*Admin &gt; Web Apps &gt; Web App Access Control &gt; Roles &gt; List Details*
</p>

1. Admin > Web Apps > Web App Access Control > Roles 메뉴로 진입하세요.
2. Create Role 버튼을 클릭하고 다음을 입력합니다.Name : QP Web Test
  1. Name : QP Web Test
3. 방금 생성한 역할을 클릭하여 상세 페이지 > Policies 탭으로 진입합니다. Assign Policies 버튼을 클릭합니다.
4. Assign Policies 모달에서 앞에서 생성한 QP Web Test 정책을 선택하고, Assign 버튼을 클릭하여 저장하고 모달을 닫습니다.

## 4. 역할을 사용자/그룹에게 할당하기
이제 방금 생성한 QP Web Test 역할을 현 사용자에게 할당해 보겠습니다.

<p align="center">
<div>[스크린샷 2025-03-30 오후 8.49.37.png]()</div>
*Admin &gt; Web Apps &gt; Web App Access Control &gt; Access Control &gt; List Details*
</p>

1. Admin > Web Apps > Web App Access Control > Access Control 메뉴로 진입하세요.
2. 역할을 할당하려는 사용자 또는 그룹을 선택합니다.지금은 테스트 중인 본인을 선택해봅니다.
  1. 지금은 테스트 중인 본인을 선택해봅니다.
3. 사용자 상세 페이지 > Roles 탭에서, Grant Roles 버튼을 클릭합니다.
4. Grant Roles 모달에서 방금 생성한 QP Web Test 를 선택하고, Grant 버튼을 클릭하여 저장합니다.만료 일자는 변경하지 않으면 오늘로부터 1년 후로 자동 설정됩니다.
  1. 만료 일자는 변경하지 않으면 오늘로부터 1년 후로 자동 설정됩니다.

이어서 방금 생성한 접근 정책이 잘 적용되었는지 확인하기 위해, 사용자쪽 설정을 진행해보겠습니다.

# User-side
## 1. Root CA 인증서 설치하기
1. QueryPie에 로그인한 상태에서 상단 우측 프로필 버튼을 클릭하고, 프로필 메뉴에서 Support > Download Web Secure 버튼을 클릭합니다.QueryPie > Profile Menu
2. QueryPie Web Secure Download 모달이 열립니다. A. Install Root CA Certificate 에서, Step 1. 내 Download Link를 클릭하면 인증서 파일 다운로드가 실행됩니다. QueryPie Web Secure Download
3. Root CA 인증서 설치 가이드에 따라 인증서 설치 및 신뢰 설정을 진행합니다.

## 2. Extension 다운로드 받기
1. QueryPie 프로필 메뉴에서 Support > Download Web Secure 버튼을 클릭합니다.
2. QueryPie Web Secure Download 모달에서 B. Install Chrome Extension > Step 1. 의 Download Link를 클릭하여 Extension 파일 다운로드를 실행합니다.

## 3. Extension 설치 및 Host 설정하기
1. Chrome 주소창에 chrome://extensions/ 을 입력합니다.
2. 페이지 우상단의 개발자 모드 토글을 활성화합니다.
3. 전달받은 Extension 파일의 압축을 풀지 않은 상태로, 확장 프로그램 영역으로 끌어넣습니다.Chrome > 확장 프로그램 관리
4. 새 탭에서 Host Configuration 페이지가 열립니다. QueryPie Host에 현재 사용중인 QueryPie 주소를 붙여넣고, Continue 버튼을 클릭합니다. Host 정보가 유효하다면 Go to Dashboard 버튼이 나타납니다. 클릭하면 새 탭에서 QueryPie로 진입합니다.Host Configuration 페이지
  1. Host 정보가 유효하다면 Go to Dashboard 버튼이 나타납니다. 클릭하면 새 탭에서 QueryPie로 진입합니다.Host Configuration 페이지

<Callout>
**주의** 
WAC 익스텐션 설치 전에 열려 있던 탭들에 대해서는 관리가 보장되지 않습니다. 접근 정책 적용 및 감사 로깅에 문제가 있을 수 있습니다. 
기존에 열려있던 모든 브라우저 탭 및 창을 닫은 후에 익스텐션을 설치하시기 바랍니다. 
</Callout>

## 4. QueryPie를 통하여 웹 앱 접근하기
1. Go to Dashboard 버튼을 클릭하여 새 탭이 열리고 QueryPie Web 콘솔이 열립니다.현재 QueryPie에 로그인된 상태라면, Web App Dashboard가 열립니다.로그인되지 않은 상태라면 로그인 페이지로 넘어갑니다. 로그인을 완료하고, 상단 메뉴에서 Web Apps를 클릭하여 대시보드로 진입하세요.Role 선택 모달이 표시되면, QP Web Test 를 선택합니다.
  1. 현재 QueryPie에 로그인된 상태라면, Web App Dashboard가 열립니다.
  2. 로그인되지 않은 상태라면 로그인 페이지로 넘어갑니다. 로그인을 완료하고, 상단 메뉴에서 Web Apps를 클릭하여 대시보드로 진입하세요.
  3. Role 선택 모달이 표시되면, QP Web Test 를 선택합니다.
2. Web App Dashboard 내 My Apps에 앞에서 등록한 QueryPie Web Site 앱 아이콘이 보일 것입니다. 아이콘을 클릭하면 웹사이트로 접속합니다.QueryPie > Web Apps > Web App Dashboard
3. 최초 접속 시, 현재 웹 세션이 기록되고 있음을 알려주는 화면이 보입니다. Continue 버튼을 클릭하여 웹사이트로 접근합니다.Web Session Monitoring Notification
4. QueryPie 홈페이지에 Watermark가 적용된 것을 확인할 수 있습니다.
5. 허용되지 않은 페이지 (예: Products 메뉴) 에 접근을 시도하는 경우 차단 안내 화면으로 리다이렉션 됩니다. QueryPie Access Denied

# Admin-side (again)
## 1. 웹 앱 접근 기록 확인하기
<p align="center">
<div>[스크린샷 2024-12-23 오전 11.56.04.png]()</div>
*Admin &gt; Audit &gt; Web Apps &gt; Web Access History*
</p>

1. Admin > Audit > Web Apps > Web Access History 로 진입합니다.
2. 현재 사용자가 접근한 웹 앱 접근 기록을 조회할 수 있습니다.Action Type : 웹 앱 접근의 시작과 종료Connect : 접근 시작해당 웹 앱에 접근한 경우 표시됨. 하위 경로를 모두 별도로 기록.Disconnect : 접근 종료탭을 닫거나 다른 페이지로 이동했을 경우 표시됨Result : 결과Success : 접근 성공Failure : 접근 실패WAC 정책에 의해 접속 차단된 경우 접근 실패로 표시
  1. Action Type : 웹 앱 접근의 시작과 종료Connect : 접근 시작해당 웹 앱에 접근한 경우 표시됨. 하위 경로를 모두 별도로 기록.Disconnect : 접근 종료탭을 닫거나 다른 페이지로 이동했을 경우 표시됨
    1. Connect : 접근 시작해당 웹 앱에 접근한 경우 표시됨. 하위 경로를 모두 별도로 기록.
      * 해당 웹 앱에 접근한 경우 표시됨. 하위 경로를 모두 별도로 기록.
    2. Disconnect : 접근 종료탭을 닫거나 다른 페이지로 이동했을 경우 표시됨
      * 탭을 닫거나 다른 페이지로 이동했을 경우 표시됨
  2. Result : 결과Success : 접근 성공Failure : 접근 실패WAC 정책에 의해 접속 차단된 경우 접근 실패로 표시
    1. Success : 접근 성공
    2. Failure : 접근 실패WAC 정책에 의해 접속 차단된 경우 접근 실패로 표시
      * WAC 정책에 의해 접속 차단된 경우 접근 실패로 표시

## 2. 사용자의 세션 기록 확인하기
웹 앱 및 역할 기준으로 사용자가 통제 대상 웹 앱에 접속하여 하위 페이지를 탐색한 기록이 모두 표시됩니다.

<Callout type="info">
Web App 생성시 User Activity Recording을 켜야만 기록이 남습니다. 
</Callout>

<p align="center">
<div>[스크린샷 2024-12-23 오전 11.58.05.png]()</div>
*Admin &gt; Audit &gt; Web Apps &gt; User Activity Recordings &gt; Details*
</p>

1. Admin > Audit > Web Apps > User Activity Recording 으로 진입합니다.
2. 현재 사용자 이름으로 남은 기록을 클릭하면, 상세 페이지로 이동합니다.
3. Event Timeline에서 사용자의 행위를 시간 순서대로 확인할 수 있습니다.필터를 클릭하면 행위 종류 별로 확인가능합니다.검색 가능한 값은 다음과 같습니다.Content (클릭한 텍스트, 또는 링크)URL (접속중이었던 페이지 URL)Tab ID (사용한 탭 아이디)
  1. 필터를 클릭하면 행위 종류 별로 확인가능합니다.
  2. 검색 가능한 값은 다음과 같습니다.Content (클릭한 텍스트, 또는 링크)URL (접속중이었던 페이지 URL)Tab ID (사용한 탭 아이디)
    1. Content (클릭한 텍스트, 또는 링크)
    2. URL (접속중이었던 페이지 URL)
    3. Tab ID (사용한 탭 아이디)
4. 이벤트 별로 사용자가 실제 보고있던 페이지의 스크린샷을 남기고 있습니다.
