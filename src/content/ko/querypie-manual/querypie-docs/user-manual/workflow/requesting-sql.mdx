import { Callout } from 'nextra/components'

## Overview
아래 순서에 따라 특정 DB 커넥션에 대해 권한이 없는 쿼리 실행을 요청할 수 있습니다. 승인 후, 실행자는 승인된 쿼리를 1회에 한하여 실행하고, 그 결과를 조회할 수 있습니다.

## SQL Request 요청하기
### 1. 결재 규칙 선택하기
* Approval Rule을 선택하여 목적에 맞는 결재 규칙을 선택하세요. 선택한 규칙에 따라 승인 대상이 달라집니다.
* 만약 관리자가 승인자를 지정한 결재 규칙이 선택된 경우, 자동으로 승인자가 지정되며 추가 및 변경이 불가합니다.

<p align="center">
<div>[image-20240807-125005.png]()</div>
</p>

### 2. 승인자 지정하기
* 결재 라인에서 + 버튼을 누르면 단계별 승인자를 지정할 수 있는 팝업창이 표시됩니다.
* 이 팝업창에서 결재 승인 조건 및 승인자를 추가 후 Save 버튼을 눌러 결재 라인을 저장합니다.
* 선택 가능한 승인 조건은 다음과 같습니다. A single Assignee can complete the approval request : 여러 명 중 한 명의 승인만으로 결재 요청이 승인 처리됩니다.All Assignees must approve this request : 모든 승인자가 승인하여야 결재 요청이 승인 처리됩니다.
  * A single Assignee can complete the approval request : 여러 명 중 한 명의 승인만으로 결재 요청이 승인 처리됩니다.
  * All Assignees must approve this request : 모든 승인자가 승인하여야 결재 요청이 승인 처리됩니다.

<p align="center">
<div>[image-20240807-125031.png]()</div>
</p>

### 3. 실행자 및 참조자 지정하기
* 결재 라인에서 + 버튼을 누르면 실행자 및 참조자를 지정할 수 있는 팝업창이 표시됩니다. 관리자가 참조자 지정을 허용하지 않은 경우에는 Reviewer 박스가 표시되지 않습니다.
  * 관리자가 참조자 지정을 허용하지 않은 경우에는 Reviewer 박스가 표시되지 않습니다.
* 이 팝업창에서 결재 승인 조건 및 승인자를 추가합니다.
* Save 버튼을 눌러 모달을 닫고 참조자 지정을 완료합니다.

<p align="center">
<div>[스크린샷 2024-08-07 오후 9.51.43.png]()</div>
</p>

### 4. 사후 승인으로 요청 보내기
* 사후 승인 기능이 허용된 결재 규칙을 선택한 경우 Urgent Mode 스위치가 표시됩니다.
* Urgent mode = On 으로 설정 후 결재 요청을 등록하면 즉시 권한을 부여받거나 작업을 수행할 수 있습니다.

<p align="center">
<div>[스크린샷 2024-08-07 오후 9.52.26.png]()</div>
</p>

<Callout type="important">
**Q. Urgent Mode 스위치가 보이지 않아요.** 
A. 관리자가 Urgent Mode를 허용하지 않은 결재 규칙을 선택한 경우, 해당 기능이 표시되지 않습니다. 
</Callout>

### 5. 요청 정보 입력하기
<p align="center">
<div>[스크린샷 2024-08-02 오전 10.38.44.png]()</div>
*User &gt; Workflow &gt; Submit Request &gt; SQL Request &gt; Request Summary*
</p>

* Title : 요청 제목을 입력합니다.
* Connection : SQL 실행을 요청할 대상 커넥션을 선택합니다. 권한이 있는 커넥션에 한해 선택 가능합니다.
* Database : 선택한 커넥션 내에서 SQL 실행을 요청할 데이터베이스를 선택합니다.
* Content Type : 요청할 SQL 구문을 입력할 방식을 선택합니다.Text : 쿼리를 최대 9999라인, 1천만자, 또는 5MB까지 작성할 수 있습니다.File : .sql 파일을 업로드할 수 있으며, 실행 용량의 제한이 없습니다. 단, Storage 구성이 필요합니다.
  * Text : 쿼리를 최대 9999라인, 1천만자, 또는 5MB까지 작성할 수 있습니다.
  * File : .sql 파일을 업로드할 수 있으며, 실행 용량의 제한이 없습니다. 단, Storage 구성이 필요합니다.
* Target Date : 해당 쿼리가 실행되기를 원하는 일자를 선택합니다. 기본 선택일은 요청일 당일입니다.
* Due Date : 승인/실행이 만료되는 일자를 선택합니다. 기본 선택일은 1년 뒤입니다.
* Reason for Request : SQL 실행 권한을 요청하는 사유를 입력합니다.
* Submit : 기안 작성 완료 후 Submit 버튼을 클릭하면 상신이 완료됩니다.

## 승인 완료된 SQL 실행하기
승인이 완료된 SQL Request 건은 승인 완료 즉시 실행할 수 있는 상태가 됩니다.

<p align="center">
<div>[스크린샷 2024-08-02 오전 10.46.03.png]()</div>
*Workflow &gt; Executions &gt; To Do &gt; Request Details &gt; Execute*
</p>

1. Workflow > Executions > To Do 메뉴로 이동합니다.
2. 실행 대기 중인 SQL Request 건을 클릭하여 상세 페이지로 이동합니다.
3. SQL Request 상세 내용을 확인 후 우측 상단의 Execute 버튼을 클릭하여 실행합니다.상세 내용 확인 후, 실행을 취소하기를 원하는 경우 Cancel 버튼을 클릭하여 취소 처리할 수 있습니다.
  1. 상세 내용 확인 후, 실행을 취소하기를 원하는 경우 Cancel 버튼을 클릭하여 취소 처리할 수 있습니다.
4. 실행이 완료된 결과는 상세 페이지 내의 Results 탭에서 성공 / 실패 여부를 확인할 수 있습니다.
5. Workflow > Received Requests > Done 메뉴에서 본인이 실행자인 요청 내역을 확인할 수 있습니다.

<Callout type="info">
DML Query 수행에 대한 승인 프로세스가 강제된 경우  `INSERT` , `UPDATE` , `DELETE` 구문 수행시 관리자가 Workflow로 승인 프로세스를 거치도록 정책을 생성한 경우가 있습니다. 이경우 Web Editor에서 쿼리 수행시 아래와 같은 메시지가 출력됩니다.  `[ENGINE][30105] In this DML operation, you need to get approval throgh SQL Request.` 
[ac:image]
[ri:attachment]

[ac:caption]
Web Editor에서 경고문 


이경우 `SEND SQL Request` 버튼을 클릭하여 바로 Workflow의 SQL Request 양식으로 이동하여 요청을 진행 할 수 있습니다.  적합한 Approval Rule을 선택해야 하고 DML 여부를 선택합니다. DML인 경우 Content Type에서 File 첨부 방식으로 수행할 수 없습니다. 
[ac:image]
[ri:attachment]

[ac:caption]
Workflow의 SQL Request 양식 


</Callout>
