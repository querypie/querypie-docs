import { Callout } from 'nextra/components'

Custom Data Source는 QueryPie에서 기본적으로 지원하지 않는 벤더에 대해 Proxy로 단순 접근제어를 하는 새로운 기능입니다. 단순 접근 제어를 제공함으로써 사용자가 더 다양한 데이터 소스에 안전하게 접근할 수 있도록 합니다. 이 기능은 10.2.6 버전에 추가되었습니다.

**주요 특징**

*  **다양한 벤더 지원 ** : QueryPie에서 지원하지 않는 데이터 소스에 접근 가능
*  **TCP 기반 접근 제어 ** : 사용자와 IP 기반의 접근 제어 제공
*  **Agent 기반 연결 ** : QueryPie Agent를 통해 서드 파티 SQL 도구로 연결 가능

### Custom Data Source 커넥션 생성
<Callout type="important">
 **주의** 
* ID/PW, SSL/TLS 세팅은 Custom Data Source에서 관리자가 할 수 없습니다.
    * 필요할 경우, 사용자가 서드 파티 SQL 도구에서 해당 인증 정보를 직접 입력해야 합니다.
* 클러스터 없는 단순 구조의 수동 등록만 생성 가능합니다.
* Query Audit 및 구문제어는 지원하지 않습니다. 
</Callout>

1.  **DB Connections 메뉴로 이동** 
    * Admin &gt; Databases &gt; Connection Management &gt; DB Connections를 선택합니다.
    * `+ Create Connection` 버튼을 클릭합니다.
2.  **Custom Data Source 생성** 
    *  Custom Data Source 아이콘을 클릭합니다.
    * 생성 시 다음과 같은 경고 메시지가 표시됩니다: **Restrictions:** 
        * Only TCP access control is available; Privileges controland Query Audit are not supported.
        * Access is only possible through a proxy; it cannot be accessed via the web editor.
    * 아래의 연결 정보를 원하는 설정에 맞게 입력합니다. ** ** 
        * Connection Name (필수) : 연결 이름 입력
        * Host (필수) : 대상 데이터 소스의 호스트 주소
        * Port (필수) : 대상 데이터 소스의 포트 번호
        * Allowed Zone (필수) : 접근 허용할 IP 범위 설정
        * Access Time (선택) : 접근 허용 시간 설정
        * Weekday Access (선택) : 접근 허용 요일 설정
        * Proxy Usage : 항상 활성화 상태 (비활성화 불가)
        * Description (선택) : 필요시 설명 추가
    * 입력 후 하단의 `Next` 버튼을 클릭하여 생성을 완료합니다. 
3.  **생성 완료** 
    * 생성 후 DB Connection 목록에서 Database Type이 Custom Data Source로 표시됩니다. 
4.  **Custom Data Source 수정 및 삭제** 
    *  **수정** 
        * Admin &gt; Databases &gt; Connection Management &gt; DB Connections 목록에서 수정하고 싶은 Custom Data Source를 선택합니다.
        * 원하는 항목을 변경할 수 있으며 Tag를 추가할 수 있습니다.
        * 수정 후 우측 상단의 `Save Changes`버튼을 클릭하여 변경사항을 저장합니다.
    *  **삭제** 
        * DB Connections 목록에서 삭제를 원하는 커넥션의 좌측 체크 박스를 선택 후 `Delete`버튼을 클릭합니다. 
        * “Are you sure you want to delete“ 문구가 나온 후 `OK`버튼을 클릭하여 커넥션을 삭제합니다.

### Access Control 설정
1.  **권한 부여 모달로 이동** 
    * Admin &gt; Databases &gt; DB Access Control &gt; Access Control을 선택합니다.
    * 권한을 부여하고 싶은 사용자를 클릭하여 Detail 페이지로 넘어갑니다.
    * 우측 중단에 `+ Grant Privilege` 버튼을 클릭합니다. 
2.  **권한 부여** 
    * 권한 부여 모달 좌측 체크박스에 Custom Data Source를 클릭합니다.
    * Custom Data Source의 Privilege는 별도 타입이 없는 "-"로 표시됩니다.
    * 부여 시 만료일(Expiration Date)을 설정할 수 있습니다.
    * 선택 완료 후 `Grant` 버튼을 눌러 권한을 부여합니다. 



1.  **권한 회수** 
    * 기본적으로는 사용자가 신청한 Expiration Date까지 권한이 유지됩니다.
    * 사용자에게 부여된 권한을 중간에 회수하려면 Privilege를 Revoke 합니다.
        * Admin &gt; Databases &gt; DB Access Control &gt; Access Control &gt; User를 선택합니다. 
        * Detail 페이지에서 권한을 회수하기 위한 커넥션을 선택한 뒤 `Revoke` 버튼을 클릭합니다.

### Audit Log 확인
1.  **DB Access History ** 
    * Admin &gt; Audit &gt; DB Access History를 선택합니다.
    * 로그 확인
        * Database Type: 'Custom Data Source'로 표시됩니다.
        * Connected From: 'Proxy'로 표시됩니다.
        * Connect/Disconnect의 Success/Failure 정보 확인 가능합니다.
            * 접속 허용 시간 외 접속 시도할 경우 모든 벤더에서 동일하게 "This connection is not accessible at this time. Please ask your administrator." 메세지가 표기됩니다.
2.  **Activity Logs ** 
    * 관리자가 Custom Data Source 커넥션 정보를 생성 / 수정 / 삭제 한 경우 기록이 남습니다.

<Callout type="important">
 **주의** 
* SQL Tool에서 인증 정보가 틀렸지만 접속을 시도할 경우에도 'Connect success, Disconnect success'로 기록됩니다.
* 벤더별 복구 프로토콜로 인해, 접속 허용 시간이 지난 후 접속이 시도되면 연결이 끊기면서 로그가 두 번 이상 기록될 수 있습니다.
</Callout>
