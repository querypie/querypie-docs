import { Callout } from 'nextra/components'

## Overview

Channels 페이지에서는 QueryPie에서 발송하는 알림을 수신할 채널을 등록 및 관리합니다. 현재 QueryPie에서 제공하는 채널 타입은 Slack, Agit, HTTP, Email의 네 가지이며, 채널 등록 사전에 연동을 위한 작업이 필요합니다.

## 등록된 채널 조회하기

Administrator &gt; General &gt; Company Management &gt; Channels 페이지에서 현재 등록된 채널 목록을 조회할 수 있습니다. 채널명으로 검색이 가능하며, Channel Type으로 필터링할 수 있습니다.

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; Company Management &gt; Channels](/administrator-manual/general/company-management/channels/screenshot-20240808-172741.png)
<figcaption>
Administrator &gt; General &gt; Company Management &gt; Channels
</figcaption>
</figure>

리스트 내 항목을 클릭하면 상세 정보를 조회 및 변경할 수 있습니다.

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; Company Management &gt; Channels &gt; List Details](/administrator-manual/general/company-management/channels/screenshot-20241211-191603.png)
<figcaption>
Administrator &gt; General &gt; Company Management &gt; Channels &gt; List Details
</figcaption>
</figure>


## 채널 등록하기

Channels 페이지 우상단 `Create Channel` 버튼을 클릭하면 채널 생성 모달이 노출됩니다.

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; Company Management &gt; Channels &gt; Create Channel](/administrator-manual/general/company-management/channels/screenshot-20241211-154231.png)
<figcaption>
Administrator &gt; General &gt; Company Management &gt; Channels &gt; Create Channel
</figcaption>
</figure>

*  **Title**  : 채널 이름
*  **Channel Type**  : 알림을 받을 채널 타입을 선택합니다. 선택지에 따라 하단 추가 입력 항목이 상이합니다.
    * Slack : Slack 채널로 알림 전송
    * Agit : 아지트로 알림 전송
    * HTTP : Zapier, Okta Workflows 등 HTTP API에 직접 요청하는 방식
    * Email : 이메일로 알림 전송

### Channel Type을`Slack`으로 선택한 경우

채널 생성을 위한 입력 내용은 다음과 같습니다.

<Callout type="info">
Slack App의 자세한 설정 방법은 문서 하단의  **Slack 연동을 위한 Slack App 설정 방법**  항목을 참고해주세요.
</Callout>

*  **Message Sending Method**  : 메시지 전송 방식
    * API : Slack API를 활용한 메시지 전송
        * API를 선택한 경우, New Request Alert 에서 승인자 (assignee) 멘션이 가능합니다. (10.2.2 버전 이후)
        * Bot User OAuth Token : 메시지를 전송할 Slack App의 Bot User OAuth Token
        * Channel ID : 메시지를 전송할 Slack App이 초대되어 있는 Slack Channel ID
    * Webhook : 웹훅 방식으로 메시지 전송
        * Request URL (필수) : 요청을 보낼 URL 
            * Slack App에서 Webhook 설정 후, Webhook URL 정보를 복사하여 붙여넣기 해야 함

### Channel Type을`Agit`로 선택한 경우

채널 생성을 위한 입력 내용은 다음과 같습니다.

*  **Request URL**  (필수) : 요청을 보낼 URL
*  **Agit Channel**  : 아지트 채널에 대해 표시할 이름 입력

Channel Type을 `HTTP`로 선택한 경우 입력 내용은 다음과 같습니다.

*  **Request URL**  (필수) : 요청을 보낼 URL
*  **Request Header (JSON)**  : 필요시 호출을 위한 요청 헤더를 입력 (JSON 형식)
*  **Body Template**  : 요청 바디 템플릿
    * 기본값 : `{{message}}`
    * Alert에서 정의되는 메시지의 앞뒤에 공통으로 추가하려는 내용을 기입

### Channel Type을`Email`로 선택한 경우

<Callout type="important">
**주의**

QueryPie에 Email 발송을 위한 SMTP 서버를 등록한 경우에만 Email 타입의 채널을 생성할 수 있습니다.

Admin &gt; General &gt; System &gt; Integration 메뉴로 진입 후, Email 타일을 클릭하여 관련 설정을 확인하세요.
</Callout>

채널 생성 시 입력 내용은 다음과 같습니다.

*  **Email Recipients**  (필수) : 이메일 수신자
    * QueryPie에 등록된 사용자를 선택할 수 있으며, 등록된 이메일 주소로 메일이 발송됨
*  **Body Template**  : 요청 바디 템플릿
    * 기본값 : `{{message}}` 
    * Alert에서 정의되는 메시지의 앞뒤에 공통으로 추가하려는 내용을 기입

## 채널 삭제하기

Channels 페이지 내 채널 목록에서 삭제하려는 채널을 체크박스로 선택하면 `Delete` 버튼이 노출됩니다. 버튼을 클릭하면 삭제 확인 모달이 출력됩니다. `OK` 버튼을 클릭하면 삭제가 완료됩니다.

<figure data-layout="center" data-align="center">
![Administrator &gt; General &gt; Company Management &gt; Channels &gt; Delete 확인 모달](/administrator-manual/general/company-management/channels/screenshot-20240728-222004.png)
<figcaption>
Administrator &gt; General &gt; Company Management &gt; Channels &gt; Delete 확인 모달
</figcaption>
</figure>

## Slack 연동을 위한 Slack App 설정 방법

### 1. App 생성하기

<figure data-layout="center" data-align="center">
![Slack API &gt; Apps &gt; Create an App](/administrator-manual/general/company-management/channels/screenshot-20240305-161015.png)
<figcaption>
Slack API &gt; Apps &gt; Create an App
</figcaption>
</figure>

1. [https://api.slack.com/apps](https://api.slack.com/apps) 으로 이동합니다.
2. `Create an App` 버튼을 클릭합니다.
3. 위 화면에서 알림을 보낼 App Name 과 Slack Workspace 를 선택합니다.
4. `Create App` 을 클릭합니다.

### 2-1. Webhook 타입으로 연동하기

<figure data-layout="center" data-align="center">
![Slack API &gt; Apps &gt; Settings &gt; Incoming Webhooks](/administrator-manual/general/company-management/channels/screenshot-20240804-190716.png)
<figcaption>
Slack API &gt; Apps &gt; Settings &gt; Incoming Webhooks
</figcaption>
</figure>

1. 해당 앱 페이지 내에서 `Incoming Webhooks` 메뉴로 이동합니다.
2. Activate Incoming Webhooks 옵션을 활성화합니다.
3. 하단의 `Add New Webhook to Workspace` 를 클릭합니다.

<figure data-layout="center" data-align="center">
![Slack 내 Webhook 추가 화면](/administrator-manual/general/company-management/channels/image-20240305-110658.png)
<figcaption>
Slack 내 Webhook 추가 화면
</figcaption>
</figure>

1. Workspace 내에 경보를 보낼 채널을 선택한 뒤 `허용` 버튼을 클릭합니다.
2. 생성된 Webhook URL 정보를 복사한 뒤, QueryPie 채널 생성 모달에 붙여넣습니다.

### 2-2. API 타입으로 연동하기

1. 생성했던 App 을 클릭하여 앱의 Settings 페이지에 진입한 뒤, `App Manifest` 메뉴로 이동합니다.
2. scopes 영역에 `chat:write`, `users:read`, `users:read.email` 을 추가한 뒤 저장합니다. 
3. 상단의 노란색 알림 바를 통해 `Reinstall your app` 을 통해 앱을 재시작합니다. (필수)
4. `Reinstall to {Workspace_name}` 버튼을 클릭하여 알림을 보낼 Slack 채널을 선택한 뒤 `허용` 버튼을 클릭합니다.
    1. Scope를 변경한 뒤 적용하려면, 이 단계를 다시 수행해야 합니다.
5. 해당 Slack 채널로 이동하여 생성한 앱을 추가합니다. (이미 앱을 추가한 상태라면 이 단계는 건너뛸 수 있습니다)
6. 채널 이름을 클릭하여 Channel Detail 모달을 열고, 모달 하단에서 Channel ID를 복사합니다. 복사한 Channel ID를 QueryPie 채널 생성 모달에 붙여넣습니다. 
7. OAuth & Permissions 페이지에서 Bot User OAuth Token 을 복사하고, QueryPie 채널 생성 모달에 붙여넣습니다. 
